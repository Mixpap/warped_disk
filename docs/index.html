<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" href="./assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" href="./assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" href="./assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>notebook.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>notebook2</title>
    <script type="module" crossorigin src="./assets/index-DKEudB02.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-Cx0bsY1w.css">
  <marimo-wasm hidden=""></marimo-wasm>
    <script>
        if (window.location.protocol === 'file:') {
            alert('Warning: This file must be served by an HTTP server to function correctly.');
        }
    </script>
    
    <style>
        #save-button {
            display: none !important;
        }
        #filename-input {
            display: none !important;
        }
    </style>
    <marimo-code hidden="">import%20marimo%0A%0A__generated_with%20%3D%20%220.16.0%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22%2C%20auto_download%3D%5B%22html%22%5D)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20from%20astropy.cosmology%20import%20FlatLambdaCDM%0A%20%20%20%20import%20astropy.units%20as%20u%0A%20%20%20%20from%20astropy%20import%20constants%20as%20const%0A%0A%20%20%20%20cosmo%20%3D%20FlatLambdaCDM(H0%3D70%2C%20Om0%3D0.3)%0A%20%20%20%20import%20matplotlib.pyplot%20as%20plt%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20from%20astropy.visualization%20import%20quantity_support%0A%20%20%20%20import%20plotly.graph_objects%20as%20go%0A%0A%20%20%20%20quantity_support()%0A%20%20%20%20return%20const%2C%20go%2C%20mo%2C%20np%2C%20plt%2C%20u%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%20Warped%20disk%20evolution%0A%20%20%20%20In%20many%20cases%20astrophysical%20disks%20(from%20protostellar%20disks%20and%20black%20hole%20accretion%20disks%20to%20to%20galaxy%20scale%20disks%2C%20so%20from%20au%20to%20kpc)%20show%20a%20warped%20structure.%20%0A%0A%20%20%20%20%23%23%20Tilted%20rings%20model%0A%20%20%20%20By%20warped%20dtructure%20we%20mean%20that%20if%20we%20describe%20the%20disk%20consisting%20of%20a%20set%20circular%20rings%20with%20spherical%20radius%20%24r%24%2C%20then%20each%20normal%20vector%20per%20ring%20%24%5Chat%7Bl%7D(r)%24%20can%20have%20different%20orientation%20which%20evolves%20also%20over%20time%20so%20%24%5Chat%7Bl%7D(t%2Cr)%24.%20If%20we%20define%20the%20inclination%20angle%20%24%5Ctheta(t%2Cr)%24%20and%20position%20angle%20%24%5Cphi(t%2Cr)%24%20then%20%24%5Chat%7Bl%7D(t%2Cr)%24%20can%20be%20defined%20as%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Chat%7Bl%7D%3D%20%0A%20%20%20%20%5Cleft(%20%5Cbegin%7Barray%7D%7Bc%7D%0A%20%20%20%20%5Csin%5Ctheta%20%5Ccos%20%5Cphi%20%5C%5C%0A%20%20%20%20%5Csin%5Ctheta%20%5Csin%20%5Cphi%20%5C%5C%0A%20%20%20%20%5Ccos%20%5Ctheta%20%5Cend%7Barray%7D%20%5Cright)%0A%20%20%20%20%24%24%0A%0A%20%20%20%20Except%20for%20the%20orientation%2C%20rings%20have%20several%20other%20properties%3A%0A%0A%20%20%20%201.%20Surface%20density%20%24%5CSigma(t%2Cr)%24%20which%20corresponds%20to%20the%20mass%20a%20ring%20is%20%22carrying%22.%0A%20%20%20%202.%20Angular%20velocity%2C%20%24%5COmega%20(r)%24%20which%20depends%20only%20on%20the%20gravitational%20potential%0A%0A%20%20%20%20With%20these%20we%20can%20define%20the%20angular%20momentum%20per%20unit%20area%20of%20each%20ring%20as%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cboldsymbol%7BL%7D%20(t%2Cr)%3D%5CSigma%20(t%2Cr)%20%5C%2C%20r%5E2%20%5C%2C%20%5COmega(r)%20%5C%2C%20%5Chat%7Bl%7D(t%2Cr)%0A%20%20%20%20%24%24%0A%0A%20%20%20%20For%20our%20example%20we%20can%20play%20with%20a%20sigmoid%20expression%20for%20the%20two%20angles%20and%20a%20gaussian%20expression%20for%20the%20surface%20density.%20For%20the%20angular%20velocity%20we%20use%20a%20typical%20Herniquist%20potential%20together%20with%20a%20SMBH%20Keplerian%20potential.%20(see%20details%20in%20the%20next%20sections)%0A%0A%20%20%20%20%2F%2F%2F%20details%20%7C%20Kinematics%20details%0A%0A%20%20%20%20We%20assume%20the%20disk%20is%20in%20a%20sperical%20stellar%20gravity%20potential%20described%20by%20the%20Hernquist%20distribution.%20%0A%20%20%20%20Hernquist%20model%20depends%20on%20the%20total%20stellar%20mass%20of%20the%20bulge%20(%24M_*%24)%20and%20a%20scale%20length%20(%24r_a%24)%20and%20has%20a%20stellar%20density%20of%20%0A%0A%20%20%20%20%5Cbegin%7Bequation*%7D%0A%20%20%20%20%20%20%20%20%5Crho(r)%3D%5Cfrac%7BM_*%7D%7B2%20%5Cpi%7D%20%5Cfrac%7Br_a%7D%7Br%7D%20%5Cfrac%7B1%7D%7B(r%2Br_a)%5E%7B3%7D%7D%0A%20%20%20%20%5Cend%7Bequation*%7D%0A%0A%20%20%20%20which%20provide%20a%20potential%20%0A%0A%20%20%20%20%5Cbegin%7Bequation*%7D%0A%20%20%20%20%20%20%20%20%5CPhi(r)%3D-%5Cfrac%7BG%20M_*%7D%7Br%2Br_a%7D%0A%20%20%20%20%5Cend%7Bequation*%7D%0A%0A%20%20%20%20The%20rotational%20velocity%20is%20found%20from%20solving%20the%20centripetal%20acceleration%20%24%5Cfrac%7B%5Cmathrm%7Bv%7D%5E2(r)%7D%7Br%7D%3D%7C%5Cvec%7BF%7D%7C%24%20as%0A%0A%20%20%20%20%5Cbegin%7Bequation*%7D%0A%20%20%20%20%20%20%20%5Cmathrm%7Bv%7D_%5Cmathrm%7BBulge%7D(r%3BM_*%2Cr_a)%20%3D%5Csqrt%7Br%5Cfrac%7Bd%7D%7Bdr%7D%20%5CPhi(r)%7D%20%3D%5Cfrac%7B%5Csqrt%7BG%20M_*%20r%7D%7D%7Br%2Br_a%7D%0A%20%20%20%20%5Cend%7Bequation*%7D%0A%0A%20%20%20%20In%20addition%20to%20the%20stellar%20component%20as%20the%20rings%20can%20reach%20the%20vicinity%20of%20the%20SMBH%20we%20add%20and%20a%20Keplerian%20component%20%0A%0A%20%20%20%20%5Cbegin%7Bequation*%7D%0A%20%20%20%20%20%20%20%20%5Cmathrm%7Bv%7D_%5Cmathrm%7BSMBH%7D(r)%20%3D%5Csqrt%7B%5Cfrac%7BG~M_%5Cmathrm%7BSMBH%7D%7D%7Br%7D%7D%0A%20%20%20%20%5Cend%7Bequation*%7D%0A%0A%20%20%20%20so%0A%0A%20%20%20%20%5Cbegin%7Bequation*%7D%0A%20%20%20%20%20%20%20%20%5Cmathrm%7BV%7D(r%3BM_*%2Cr_a%2CM_%5Cmathrm%7BSMBH%7D)%3D%5Csqrt%7B%5Cmathrm%7Bv%7D%5E2_%5Cmathrm%7BSMBH%7D(r)%2B%5Cmathrm%7Bv%7D%5E2_%5Cmathrm%7BBulge%7D(r%3BM_*%2Cr_a)%7D%0A%20%20%20%20%5Cend%7Bequation*%7D%0A%0A%20%20%20%20%2F%2F%2F%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20theta_io%20%3D%20mo.ui.range_slider(%0A%20%20%20%20%20%20%20%20start%3D0%2C%20stop%3D80%2C%20step%3D5%2C%20value%3D%5B30%2C%2040%5D%2C%20label%3Dr%22%24%5Ctheta%24%20range%22%0A%20%20%20%20)%0A%20%20%20%20theta_center_io%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0.5%2C%20stop%3D5%2C%20step%3D0.25%2C%20value%3D3%2C%20label%3Dr%22%24%5Ctheta%24%20center%22%0A%20%20%20%20)%0A%20%20%20%20theta_scale_io%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0.5%2C%20stop%3D5%2C%20step%3D0.25%2C%20value%3D2%2C%20label%3Dr%22%24%5Ctheta%24%20scale%22%0A%20%20%20%20)%0A%0A%20%20%20%20phi_io%20%3D%20mo.ui.range_slider(%0A%20%20%20%20%20%20%20%20start%3D0%2C%20stop%3D80%2C%20step%3D5%2C%20value%3D%5B30%2C%2040%5D%2C%20label%3Dr%22%24%5Cphi%24%20range%22%0A%20%20%20%20)%0A%20%20%20%20phi_center_io%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0.5%2C%20stop%3D5%2C%20step%3D0.25%2C%20value%3D3%2C%20label%3Dr%22%24%5Cphi%24%20center%22%0A%20%20%20%20)%0A%20%20%20%20phi_scale_io%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0.5%2C%20stop%3D5%2C%20step%3D0.25%2C%20value%3D2%2C%20label%3Dr%22%24%5Cphi%24%20scale%22%0A%20%20%20%20)%0A%0A%0A%20%20%20%20sigma_bck_io%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0.5%2C%0A%20%20%20%20%20%20%20%20stop%3D10%2C%0A%20%20%20%20%20%20%20%20step%3D0.5%2C%0A%20%20%20%20%20%20%20%20value%3D3%2C%0A%20%20%20%20%20%20%20%20label%3Dr%22Surface%20density%20baseline%20(%24%5Cmathrm%7BM_%5Codot%2Fkpc%7D%24)%22%2C%0A%20%20%20%20)%0A%20%20%20%20sigma_gs_io%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0%2C%0A%20%20%20%20%20%20%20%20stop%3D10%2C%0A%20%20%20%20%20%20%20%20step%3D0.5%2C%0A%20%20%20%20%20%20%20%20value%3D2%2C%0A%20%20%20%20%20%20%20%20label%3Dr%22Surface%20density%20gaussian%20scale%20(%24%5Cmathrm%7BM_%5Codot%2Fkpc%7D%24)%22%2C%0A%20%20%20%20)%0A%20%20%20%20sigma_gc_io%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0.5%2C%0A%20%20%20%20%20%20%20%20stop%3D10%2C%0A%20%20%20%20%20%20%20%20step%3D0.5%2C%0A%20%20%20%20%20%20%20%20value%3D4%2C%0A%20%20%20%20%20%20%20%20label%3Dr%22Surface%20density%20gaussian%20center%20(%24%5Cmathrm%7Bkpc%7D%24)%22%2C%0A%20%20%20%20)%0A%20%20%20%20sigma_gd_io%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0.5%2C%0A%20%20%20%20%20%20%20%20stop%3D10%2C%0A%20%20%20%20%20%20%20%20step%3D0.5%2C%0A%20%20%20%20%20%20%20%20value%3D1%2C%0A%20%20%20%20%20%20%20%20label%3Dr%22Surface%20density%20gaussian%20dispersion%20(%24%5Cmathrm%7Bkpc%7D%24)%22%2C%0A%20%20%20%20)%0A%0A%20%20%20%20mo.accordion(%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Initial%20Conditions%20parameters%20(expand%20to%20play)%22%3A%20mo.vstack(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mo.hstack(%5Btheta_io%2C%20theta_center_io%2C%20theta_scale_io%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mo.hstack(%5Bphi_io%2C%20phi_center_io%2C%20phi_scale_io%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mo.hstack(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bsigma_bck_io%2C%20sigma_gs_io%2C%20sigma_gc_io%2C%20sigma_gd_io%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20)%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20phi_center_io%2C%0A%20%20%20%20%20%20%20%20phi_io%2C%0A%20%20%20%20%20%20%20%20phi_scale_io%2C%0A%20%20%20%20%20%20%20%20sigma_bck_io%2C%0A%20%20%20%20%20%20%20%20sigma_gc_io%2C%0A%20%20%20%20%20%20%20%20sigma_gd_io%2C%0A%20%20%20%20%20%20%20%20sigma_gs_io%2C%0A%20%20%20%20%20%20%20%20theta_center_io%2C%0A%20%20%20%20%20%20%20%20theta_io%2C%0A%20%20%20%20%20%20%20%20theta_scale_io%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20np%2C%0A%20%20%20%20phi_center_io%2C%0A%20%20%20%20phi_io%2C%0A%20%20%20%20phi_scale_io%2C%0A%20%20%20%20sigma_bck_io%2C%0A%20%20%20%20sigma_gc_io%2C%0A%20%20%20%20sigma_gd_io%2C%0A%20%20%20%20sigma_gs_io%2C%0A%20%20%20%20theta_center_io%2C%0A%20%20%20%20theta_io%2C%0A%20%20%20%20theta_scale_io%2C%0A%20%20%20%20u%2C%0A)%3A%0A%20%20%20%20rr%20%3D%20np.linspace(0.1%2C%2010.0%2C%20100)%20*%20u.kpc%0A%0A%0A%20%20%20%20def%20theta0(r)%3A%0A%20%20%20%20%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20theta_io.value%5B0%5D%20*%20u.deg%0A%20%20%20%20%20%20%20%20%20%20%20%20%2B%20(theta_io.value%5B1%5D%20-%20theta_io.value%5B0%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%201%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20np.exp(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-theta_scale_io.value%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*%20(r%20-%20theta_center_io.value%20*%20u.kpc)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%20u.kpc%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20*%20u.deg%0A%20%20%20%20%20%20%20%20)%0A%0A%0A%20%20%20%20theta_expr%20%3D%20f%22%24%5C%5Ctheta_0(r)%20%3D%20%7Btheta_io.value%5B0%5D%7D%2B%5C%5Cfrac%7B%7B%20%7Btheta_io.value%5B1%5D%20-%20theta_io.value%5B0%5D%7D%20%7D%7D%20%7B%7B1%2Be%5E%7B%7B-%7Btheta_scale_io.value%7D(r-%7Btheta_center_io.value%7D)%7D%7D%20%7D%7D%24%22%0A%0A%0A%20%20%20%20def%20phi0(r)%3A%0A%20%20%20%20%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20phi_io.value%5B0%5D%20*%20u.deg%0A%20%20%20%20%20%20%20%20%20%20%20%20%2B%20(phi_io.value%5B1%5D%20-%20phi_io.value%5B0%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%201%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20np.exp(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-phi_scale_io.value%20*%20(r%20-%20phi_center_io.value%20*%20u.kpc)%20%2F%20u.kpc%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20*%20u.deg%0A%20%20%20%20%20%20%20%20)%0A%0A%0A%20%20%20%20phi_expr%20%3D%20f%22%24%5C%5Cphi_0(r)%20%3D%20%7Bphi_io.value%5B0%5D%7D%2B%5C%5Cfrac%7B%7B%20%7Bphi_io.value%5B1%5D%20-%20phi_io.value%5B0%5D%7D%20%7D%7D%20%7B%7B1%2Be%5E%7B%7B-%7Bphi_scale_io.value%7D(r-%7Bphi_center_io.value%7D)%7D%7D%20%7D%7D%24%22%0A%0A%0A%20%20%20%20def%20Sigma0(r)%3A%0A%20%20%20%20%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20sigma_bck_io.value%20*%20u.solMass%20%2F%20u.kpc**2%0A%20%20%20%20%20%20%20%20%20%20%20%20%2B%20sigma_gs_io.value%0A%20%20%20%20%20%20%20%20%20%20%20%20*%20np.exp(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-((sigma_gc_io.value%20-%20r.value)%20**%202)%20%2F%20(2%20*%20sigma_gd_io.value**2)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20*%20u.solMass%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%20u.kpc**2%0A%20%20%20%20%20%20%20%20)%0A%0A%0A%20%20%20%20%23%20mo.hstack(%0A%20%20%20%20%23%20%20%20%20%20%5B%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20mo.mpl.interactive(plt.gcf())%2C%0A%20%20%20%20%23%20%20%20%20%20%5D%0A%20%20%20%20%23%20)%0A%20%20%20%20%23%20mo.accordion(%0A%20%20%20%20%23%20%20%20%20%20%7B%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%22Show%20Initial%20condition%20plots%22%3A%20fig%20%20%23%20mo.mpl.interactive(plt.gcf())%0A%20%20%20%20%23%20%20%20%20%20%7D%2C%0A%20%20%20%20%23%20%20%20%20%20lazy%3DTrue%2C%0A%20%20%20%20%23%20)%0A%20%20%20%20return%20Sigma0%2C%20phi0%2C%20phi_expr%2C%20rr%2C%20theta0%2C%20theta_expr%0A%0A%0A%40app.cell%0Adef%20_3d_plot(Sigma0%2C%20go%2C%20mo%2C%20np%2C%20phi0%2C%20phi_expr%2C%20plt%2C%20rr%2C%20theta0%2C%20theta_expr)%3A%0A%20%20%20%20fig%2C%20ax%20%3D%20plt.subplot_mosaic(%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20AS%0A%20%20%20%20%20%20%20%20%22%22%22%2C%0A%20%20%20%20%20%20%20%20figsize%3D(12%2C%205)%2C%0A%20%20%20%20)%0A%20%20%20%20ax%5B%22A%22%5D.plot(rr%2C%20theta0(rr)%2C%20label%3Dtheta_expr)%0A%20%20%20%20ax%5B%22A%22%5D.plot(rr%2C%20phi0(rr)%2C%20label%3Dphi_expr)%0A%0A%20%20%20%20ax%5B%22A%22%5D.legend()%0A%20%20%20%20ax%5B%22S%22%5D.plot(rr%2C%20Sigma0(rr))%0A%20%20%20%20ax%5B%22A%22%5D.set(title%3D%22Angles%22)%0A%20%20%20%20ax%5B%22S%22%5D.set(title%3D%22Surface%20Density%22)%0A%0A%0A%20%20%20%20%CE%B8%20%3D%20np.deg2rad(theta0(rr).value)%0A%20%20%20%20%CF%86%20%3D%20np.deg2rad(%0A%20%20%20%20%20%20%20%20phi0(rr).value%0A%20%20%20%20)%20%20%23%20np.arctan2(-lx0(rr)%20%2F%20np.sin(%CE%B8)%2C%20(rr.value)%20%2F%20np.sin(%CE%B8))%0A%20%20%20%20s%20%3D%20Sigma0(rr).value%0A%0A%20%20%20%20%23%20Define%20the%20number%20of%20points%20for%20each%20circle%0A%20%20%20%20num_points%20%3D%20100%0A%0A%20%20%20%20%23%20Create%20a%203D%20plot%20with%20circles%20for%20each%20radius%0A%20%20%20%20fig3d%20%3D%20go.Figure()%0A%0A%20%20%20%20%23%20sigma_min%2C%20sigma_max%20%3D%20sigma_values.min()%2C%20sigma_values.max()%0A%20%20%20%20%23%20normalized_sigma%20%3D%20(sigma_values%20-%20sigma_min)%20%2F%20(sigma_max%20-%20sigma_min)%0A%0A%20%20%20%20%23%20Loop%20over%20each%20radius%20to%20create%20a%20circle%0A%20%20%20%20for%20i%2C%20r%20in%20enumerate(rr.value)%3A%0A%20%20%20%20%20%20%20%20theta%20%3D%20np.linspace(0%2C%202%20*%20np.pi%2C%20num_points)%0A%20%20%20%20%20%20%20%20x%20%3D%20r%20*%20np.cos(theta)%0A%20%20%20%20%20%20%20%20y%20%3D%20r%20*%20np.sin(theta)%0A%20%20%20%20%20%20%20%20z%20%3D%20np.zeros_like(x)%20%20%23%20All%20points%20lie%20in%20the%20xy-plane%0A%0A%20%20%20%20%20%20%20%20cos%CE%B8%2C%20sin%CE%B8%20%3D%20np.cos(%CE%B8%5Bi%5D)%2C%20np.sin(%CE%B8%5Bi%5D)%0A%20%20%20%20%20%20%20%20cos%CF%86%2C%20sin%CF%86%20%3D%20np.cos(%CF%86%5Bi%5D)%2C%20np.sin(%CF%86%5Bi%5D)%0A%20%20%20%20%20%20%20%20x_rot%20%3D%20x%20*%20cos%CF%86%20%2B%20y%20*%20sin%CF%86%0A%20%20%20%20%20%20%20%20y_rot%20%3D%20-x%20*%20sin%CE%B8%20*%20sin%CF%86%20%2B%20y%20*%20sin%CE%B8%20*%20cos%CF%86%20%2B%20z%20*%20cos%CE%B8%0A%20%20%20%20%20%20%20%20z_rot%20%3D%20x%20*%20cos%CE%B8%20*%20sin%CF%86%20-%20y%20*%20cos%CE%B8%20*%20cos%CF%86%20%2B%20z%20*%20sin%CE%B8%0A%20%20%20%20%20%20%20%20sigma_value%20%3D%20Sigma0(rr%5Bi%5D).value%20%2F%20Sigma0(rr).value.max()%0A%20%20%20%20%20%20%20%20color_data%20%3D%20np.full(num_points%2C%20Sigma0(rr%5Bi%5D).value)%0A%0A%20%20%20%20%20%20%20%20%23%20Add%20the%20circle%20to%20the%20plot%0A%20%20%20%20%20%20%20%20fig3d.add_trace(%0A%20%20%20%20%20%20%20%20%20%20%20%20go.Scatter3d(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%3Dx_rot%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%3Dy_rot%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20z%3Dz_rot%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mode%3D%22lines%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20line%3Ddict(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20width%3D3%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color%3Dcolor_data%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cmin%3D0.1%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cmax%3DSigma0(rr).value.max()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20colorscale%3D%22Greys%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%2C%20%20%23%20%2C%20showscale%3DTrue)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20showlegend%3DFalse%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%23%20Update%20layout%20for%20better%20visualization%0A%20%20%20%20fig3d.update_layout(%0A%20%20%20%20%20%20%20%20scene%3Ddict(%0A%20%20%20%20%20%20%20%20%20%20%20%20xaxis_title%3D%22X%20%5Bkpc%5D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20yaxis_title%3D%22Y%20%5Bkpc%5D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20zaxis_title%3D%22Z%20%5Bkpc%5D%22%2C%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20title%3D%223D%20Circles%20for%20Each%20Radius%22%2C%0A%20%20%20%20%20%20%20%20margin%3Ddict(l%3D0%2C%20r%3D0%2C%20b%3D0%2C%20t%3D40)%2C%0A%20%20%20%20)%0A%0A%20%20%20%20%23%20Display%20the%20plot%0A%0A%20%20%20%20mo.accordion(%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Plots%22%3A%20fig%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Show%203D%20plot%22%3A%20mo.ui.plotly(fig3d)%2C%20%20%23%20mo.mpl.interactive(plt.gcf())%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20lazy%3DTrue%2C%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20Mhern_io%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0.5%2C%0A%20%20%20%20%20%20%20%20stop%3D15%2C%0A%20%20%20%20%20%20%20%20step%3D0.5%2C%0A%20%20%20%20%20%20%20%20value%3D1%2C%0A%20%20%20%20%20%20%20%20label%3Dr%22Hernquist%20(stellar)%20mass%20(%24%5Ctimes10%5E%7B11%7D%5C%2C%5Cmathrm%7BM_%5Codot%7D%24)%22%2C%0A%20%20%20%20)%0A%20%20%20%20a_hern_io%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0.5%2C%20stop%3D5.0%2C%20step%3D0.5%2C%20value%3D2%2C%20label%3Dr%22Hernquist%20scale%20(kpc)%22%0A%20%20%20%20)%0A%20%20%20%20Mbh_io%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D0.5%2C%0A%20%20%20%20%20%20%20%20stop%3D15%2C%0A%20%20%20%20%20%20%20%20step%3D0.5%2C%0A%20%20%20%20%20%20%20%20value%3D4%2C%0A%20%20%20%20%20%20%20%20label%3Dr%22SMBH%20mass%20(%24%5Ctimes10%5E%7B8%7D%5C%2C%5Cmathrm%7BM_%5Codot%7D%24)%22%2C%0A%20%20%20%20)%0A%0A%0A%20%20%20%20sigma_gas_io%20%3D%20mo.ui.slider(%0A%20%20%20%20%20%20%20%20start%3D2%2C%0A%20%20%20%20%20%20%20%20stop%3D80%2C%0A%20%20%20%20%20%20%20%20step%3D1%2C%0A%20%20%20%20%20%20%20%20value%3D12%2C%0A%20%20%20%20%20%20%20%20label%3Dr%22Gas%20velocity%20dispersion%20(%24%5Cmathrm%7Bkm%2Fs%7D%24)%20-constant-%22%2C%0A%20%20%20%20)%0A%0A%20%20%20%20pars_kinematics%20%3D%20mo.vstack(%0A%20%20%20%20%20%20%20%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.hstack(%5BMhern_io%2C%20a_hern_io%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.hstack(%5BMbh_io%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20mo.hstack(%5Btheta_io%2C%20theta_center_io%2C%20theta_scale_io%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20mo.hstack(%5Bphi_io%2C%20phi_center_io%2C%20phi_scale_io%5D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.hstack(%5Bsigma_gas_io%5D)%2C%0A%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20)%0A%20%20%20%20mo.accordion(items%3D%7B%22Kinematics%20Parameters%20(expand%20to%20play)%22%3A%20pars_kinematics%7D)%0A%20%20%20%20return%20Mbh_io%2C%20Mhern_io%2C%20a_hern_io%2C%20sigma_gas_io%0A%0A%0A%40app.cell%0Adef%20_(Mbh_io%2C%20Mhern_io%2C%20a_hern_io%2C%20const%2C%20mo%2C%20np%2C%20plt%2C%20rr%2C%20u)%3A%0A%20%20%20%20G%20%3D%20const.G.to(u.kpc%20%2F%20u.solMass%20*%20(u.km%20%2F%20u.s)%20**%202)%0A%20%20%20%20eo%20%3D%202%0A%20%20%20%20Mbh%20%3D%20Mbh_io.value%20*%20u.solMass%0A%20%20%20%20Mstar%20%3D%20Mhern_io.value%20*%201e11%20*%20u.solMass%0A%20%20%20%20a_hern%20%3D%20a_hern_io.value%20*%20u.kpc%0A%20%20%20%20Vcirc%20%3D%20lambda%20r%3A%20np.sqrt(G%20*%20Mbh%20%2F%20r%20%2B%20(G%20*%20Mstar%20*%20r)%20%2F%20(r%20%2B%20a_hern)%20**%202)%0A%20%20%20%20W%20%3D%20lambda%20r%3A%20Vcirc(r)%20%2F%20r%0A%20%20%20%20dW%20%3D%20lambda%20r%3A%20np.gradient(W(r)%2C%20r%2C%20edge_order%3Deo)%0A%20%20%20%20dr2W%20%3D%20lambda%20r%3A%20np.gradient(r**2%20*%20W(r)%2C%20r%2C%20edge_order%3Deo)%0A%20%20%20%20dr3W%20%3D%20lambda%20r%3A%20np.gradient(r**3%20*%20W(r)%2C%20r%2C%20edge_order%3Deo)%0A%20%20%20%20k%20%3D%20lambda%20r%3A%20np.sqrt(%0A%20%20%20%20%20%20%20%202%20*%20W(r)%20%2F%20r%20*%20np.gradient(r**2%20*%20W(r)%2C%20r%2C%20edge_order%3Deo)%0A%20%20%20%20)%0A%0A%20%20%20%20figV%2C%20axV%20%3D%20plt.subplot_mosaic(%5B%5B%22Vc%22%2C%20%22W%22%2C%20%22k%22%5D%5D%2C%20figsize%3D(16%2C%205))%0A%20%20%20%20axV%5B%22Vc%22%5D.plot(rr%2C%20Vcirc(rr))%0A%20%20%20%20axV%5B%22W%22%5D.plot(rr%2C%20W(rr))%0A%20%20%20%20axV%5B%22k%22%5D.plot(rr%2C%20k(rr))%0A%0A%20%20%20%20axV%5B%22Vc%22%5D.set(title%3D%22Circular%20Velocity%22)%0A%20%20%20%20axV%5B%22W%22%5D.set(title%3D%22Angular%20Velocity%22)%0A%20%20%20%20axV%5B%22k%22%5D.set(title%3D%22Epicyclic%20frequency%22)%0A%0A%20%20%20%20%23%20mo.mpl.interactive(plt.gcf())%0A%20%20%20%20mo.accordion(%7B%22Velocity%20Plots%22%3A%20figV%7D)%0A%20%20%20%20return%20W%2C%20dW%2C%20dr2W%2C%20eo%2C%20k%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20%CE%B8%20%3D%20np.arccos(lz0(rr))%0A%20%20%20%20%23%20%CF%86%20%3D%20np.arctan2(-lx0(rr)%20%2F%20np.sin(%CE%B8)%2C%20(rr.value)%20%2F%20np.sin(%CE%B8))%0A%20%20%20%20%23%20s%20%3D%20Sigma0(rr).value%0A%0A%20%20%20%20%23%20%23%20Define%20the%20number%20of%20points%20for%20each%20circle%0A%20%20%20%20%23%20num_points%20%3D%20100%0A%0A%20%20%20%20%23%20%23%20Create%20a%203D%20plot%20with%20circles%20for%20each%20radius%0A%20%20%20%20%23%20fig3d%20%3D%20go.Figure()%0A%0A%20%20%20%20%23%20%23%20sigma_min%2C%20sigma_max%20%3D%20sigma_values.min()%2C%20sigma_values.max()%0A%20%20%20%20%23%20%23%20normalized_sigma%20%3D%20(sigma_values%20-%20sigma_min)%20%2F%20(sigma_max%20-%20sigma_min)%0A%0A%20%20%20%20%23%20%23%20Loop%20over%20each%20radius%20to%20create%20a%20circle%0A%20%20%20%20%23%20for%20i%2C%20r%20in%20enumerate(rr.value)%3A%0A%20%20%20%20%23%20%20%20%20%20theta%20%3D%20np.linspace(0%2C%202%20*%20np.pi%2C%20num_points)%0A%20%20%20%20%23%20%20%20%20%20x%20%3D%20r%20*%20np.cos(theta)%0A%20%20%20%20%23%20%20%20%20%20y%20%3D%20r%20*%20np.sin(theta)%0A%20%20%20%20%23%20%20%20%20%20z%20%3D%20np.zeros_like(x)%20%20%23%20All%20points%20lie%20in%20the%20xy-plane%0A%0A%20%20%20%20%23%20%20%20%20%20cos%CE%B8%2C%20sin%CE%B8%20%3D%20np.cos(%CE%B8%5Bi%5D)%2C%20np.sin(%CE%B8%5Bi%5D)%0A%20%20%20%20%23%20%20%20%20%20cos%CF%86%2C%20sin%CF%86%20%3D%20np.cos(%CF%86%5Bi%5D)%2C%20np.sin(%CF%86%5Bi%5D)%0A%20%20%20%20%23%20%20%20%20%20x_rot%20%3D%20x%20*%20cos%CF%86%20%2B%20y%20*%20sin%CF%86%0A%20%20%20%20%23%20%20%20%20%20y_rot%20%3D%20-x%20*%20sin%CE%B8%20*%20sin%CF%86%20%2B%20y%20*%20sin%CE%B8%20*%20cos%CF%86%20%2B%20z%20*%20cos%CE%B8%0A%20%20%20%20%23%20%20%20%20%20z_rot%20%3D%20x%20*%20cos%CE%B8%20*%20sin%CF%86%20-%20y%20*%20cos%CE%B8%20*%20cos%CF%86%20%2B%20z%20*%20sin%CE%B8%0A%20%20%20%20%23%20%20%20%20%20sigma_value%20%3D%20Sigma0(rr%5Bi%5D).value%20%2F%20Sigma0(rr).value.max()%0A%0A%20%20%20%20%23%20%20%20%20%20%23%20Add%20the%20circle%20to%20the%20plot%0A%20%20%20%20%23%20%20%20%20%20fig3d.add_trace(%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20go.Scatter3d(%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20x%3Dx_rot%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20y%3Dy_rot%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20z%3Dz_rot%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20mode%3D%22lines%22%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20line%3Ddict(width%3D2%2C%20color%3Dsigma_value%2C%20colorscale%3D%22Magma%22)%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20%20%20%20%20showlegend%3DFalse%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%23%20%20%20%20%20)%0A%0A%20%20%20%20%23%20%23%20Update%20layout%20for%20better%20visualization%0A%20%20%20%20%23%20fig3d.update_layout(%0A%20%20%20%20%23%20%20%20%20%20scene%3Ddict(%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20xaxis_title%3D%22X%22%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20yaxis_title%3D%22Y%22%2C%0A%20%20%20%20%23%20%20%20%20%20%20%20%20%20zaxis_title%3D%22Z%22%2C%0A%20%20%20%20%23%20%20%20%20%20)%2C%0A%20%20%20%20%23%20%20%20%20%20title%3D%223D%20Circles%20for%20Each%20Radius%22%2C%0A%20%20%20%20%23%20%20%20%20%20margin%3Ddict(l%3D0%2C%20r%3D0%2C%20b%3D0%2C%20t%3D40)%2C%0A%20%20%20%20%23%20)%0A%0A%20%20%20%20%23%20%23%20Display%20the%20plot%0A%20%20%20%20%23%20mo.ui.plotly(fig3d)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Disk%20Kinematic%20Viscosity%0A%20%20%20%20The%20kinematic%20viscosity%20%24%5Cnu%24%20is%20related%20to%20the%20dynamic%20viscosity%20coefficient%20%24%5Ceta%24%20and%20the%20gas%20density%20%24%5Crho%24.%0A%0A%20%20%20%20%2F%2F%2F%20Details%20%7C%20Shakura%20%26%20Sunyaev%20accretion%20disk%20approach%20%0A%0A%20%20%20%20%23%23%23%20Shakura%20%26%20Sunyaev%20accretion%20disk%20approach%20%0A%20%20%20%20The%20most%20known%20kinematic%20viscosity%20approxiamtion%20is%20the%20Shakura%20%5C%26%20Sunyaev%20accretion%20disk%20where%20we%20consider%20a%20locally%20isothermal%20disk%20with%20aspect%20ratio%20%24H%20%2F%20R%24%2C%20where%20%24H%24%20is%20the%20disk%20scale%20height.%0A%0A%20%20%20%20Angular%20momentum%20transport%20in%20an%20accretion%20disk%20is%20driven%20by%20turbulent%20eddies%20with%20a%20maximum%20size%20%24H%24%2C%20and%20maximum%20speed%20the%20sound%20speed%2C%20%24c_%7B%5Cmathrm%7Bs%7D%7D%3DH%20%5COmega%24.%20%0A%0A%20%20%20%20The%20azimuthal%20shear%20viscosity%20has%20the%20standard%20form%0A%0A%20%20%20%20%5Cbegin%7Bequation*%7D%0A%20%20%20%20%5Cnu_1%20(r)%3D%5Calpha_1%5Cleft(%5Cfrac%7BH%7D%7Br%7D%5Cright)%5E2%20r%5E2%20%5COmega%0A%20%20%20%20%5Cend%7Bequation*%7D%0A%0A%20%20%20%20%5Cbegin%7Bequation*%7D%0A%20%20%20%20%5Cnu_2%20(r)%3D%5Calpha_2%5Cleft(%5Cfrac%7BH%7D%7Br%7D%5Cright)%5E2%20r%5E2%20%5COmega%2C%0A%20%20%20%20%5Cend%7Bequation*%7D%0A%0A%20%20%20%20(Papaloizou%20%26%20Pringle%201983)%2C%20where%20%24%5Calpha_2%20%5Csimeq%201%20%2F(2%20%5Calpha)%24%20in%20the%20linear%20approximation.%0A%0A%20%20%20%20%23%23%23%20Note%3A%0A%20%20%20%20**This%20approximation%20is%20used%20in%20accretion%20disks.**%20As%20we%20will%20note%20later%2C%20on%20the%20equations%20section%2C%20the%20literature%20is%20focused%2099.9%25%20on%20accretion%20and%20protostellar%20disks.%20This%20makes%20hard%20for%20us%20to%20build%20up%20and%20provide%20a%20framework%20for%20a%20large-galaxy%20scale%20warp.%20Of%20course%20there%20are%20**reasons**%20for%20this%2C%20galaxies%20are%20more%20complicated%20(they%20have%20)%0A%0A%20%20%20%20%2F%2F%2F%0A%0A%20%20%20%20%2F%2F%2F%20Details%20%7C%20Cloud%20fluid%20approximation%0A%0A%20%20%20%20%20%20%23%23%23%20Cloud%20fluid%20approximation%20for%20a%20galactic%20gas%20disk%0A%20%20%20%20For%20large%20scale%20disks%20we%20follow%20the%20approxiamtion%20of%20Steiman%20Cameron%201988%20approximation.%0A%20%20%20%20We%20assume%20that%20the%20molecular%20clouds%20are%20close%20to%20hard%20spheres%20of%20radius%20%24R_c%24%20and%20mass%20%24m%24%20their%20dynamic%20viscosity%20coefficient%20is%20(Reif%2B1965)%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cmu%3D%200.319%20%5Cfrac%7Bm%5Csigma%7D%7B%5Csigma%20_%7B0%7D%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20where%20%24%5Csigma_%7B0%7D%20%3D4%5Cpi%20c%20R_%7Bc%7D%5E2%24%20and%20%24c%3C1%24%20is%20a%20factor%20of%20the%20%22closeness%22%20to%20a%20hard%20sphere%20with%20typical%20value%20of%20%24c%5Csim0.2%24%20(Scalo%2B1982).%0A%20%20%20%20Assuming%20Maxwellian%20velocity%20distribution%2C%20we%20get%20for%20the%20kinematic%20viscocity%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cnu%3D0.451%20l%20%5Csigma%0A%20%20%20%20%24%24%0A%0A%20%20%20%20where%20%24l%20%3D(n%20%5Csigma)%5E%7B-1%7D%24%20is%20the%20mean%20free%20path%20of%20the%20clouds.%20%0A%0A%20%20%20%20The%20mean%20path%20of%20the%20cloud%20can%20be%20estimated%20using%20the%20radial%20extent%20over%20a%20cloud%20can%20travel%20using%20the%20epicyclin%20amplitude%20%24k%24.%0A%0A%20%20%20%20Together%20with%20the%20assumption%20of%20isotropic%20velocity%20dispersion%20the%20kinematic%20viscosity%20is%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cnu%20%3D%200.26%20%5Cfrac%7B%5Csigma%5E2%7D%7Bk%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20with%20typical%20values%20at%201%20kpc%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%20%5Cleft%5B%20%5Cfrac%7B%5Cnu%7D%7B%5Cmathrm%7Bkpc%5E2%5C%2CGyr%5E%7B-1%7D%7D%7D%20%5Cright%5D%3D%200.15%20%5Cleft%5B%20%5Cfrac%7B%5Csigma%7D%7B%5Cmathrm%7B20%5C%2Ckm%5C%2Cs%5E%7B-1%7D%7D%7D%20%5Cright%5D%5E%7B2%7D%20%5Cleft%5B%20%5Cfrac%7Bk%7D%7B%5Cmathrm%7B700%5C%2Ckm%5C%2Cs%5E%7B-1%7D%5C%2Ckpc%5E%7B-1%7D%7D%7D%20%5Cright%5D%5E%7B-1%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20using%20%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Ckappa%5E%7B2%7D%20%3D%20%5Cfrac%7B2%20%5COmega%7D%7BR%7D%20%5Cfrac%7Bd%7D%7Bd%20R%7D%5Cleft(R%5E%7B2%7D%20%5COmega%5Cright)%20%0A%20%20%20%20%24%24%0A%0A%20%20%20%20the%20epicyclic%20frequency%20of%20the%20disk.%0A%0A%20%20%20%20%2F%2F%2F%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(k%2C%20mo%2C%20plt%2C%20rr%2C%20sigma_gas_io%2C%20u)%3A%0A%20%20%20%20sigma_gas%20%3D%20sigma_gas_io.value%20*%20u.km%20%2F%20u.s%0A%20%20%20%20nu1%20%3D%20lambda%20r%3A%20(sigma_gas**2%20%2F%20k(r)).to(u.kpc**2%20%2F%20u.Gyr)%0A%20%20%20%20nu2%20%3D%20lambda%20r%3A%20(sigma_gas**2%20%2F%20k(r)).to(u.kpc**2%20%2F%20u.Gyr)%0A%0A%20%20%20%20fignu%2C%20axnu%20%3D%20plt.subplot_mosaic(%5B%5B%22nu1%22%2C%20%22nu2%22%2C%20%22nu3%22%5D%5D%2C%20figsize%3D(16%2C%205))%0A%20%20%20%20axnu%5B%22nu1%22%5D.plot(rr%2C%20nu1(rr))%0A%20%20%20%20axnu%5B%22nu2%22%5D.plot(rr%2C%20nu2(rr))%0A%0A%20%20%20%20axnu%5B%22nu1%22%5D.set(title%3D%22nu1%22)%0A%20%20%20%20axnu%5B%22nu2%22%5D.set(title%3D%22nu2%20(%3Dnu1)%22)%0A%20%20%20%20%23%20mo.mpl.interactive(plt.gcf())%0A%20%20%20%20mo.accordion(%7B%22Viscosity%20plots%22%3A%20fignu%7D)%0A%20%20%20%20return%20nu1%2C%20nu2%0A%0A%0A%40app.cell%0Adef%20_(Sigma0%2C%20W%2C%20dW%2C%20eo%2C%20mo%2C%20np%2C%20nu1%2C%20nu2%2C%20phi0%2C%20plt%2C%20rr%2C%20theta0)%3A%0A%20%20%20%20lx0%20%3D%20lambda%20r%3A%20np.sin(theta0(r))%20*%20np.cos(phi0(r))%0A%20%20%20%20ly0%20%3D%20lambda%20r%3A%20np.sin(theta0(r))%20*%20np.sin(phi0(r))%0A%20%20%20%20lz0%20%3D%20lambda%20r%3A%20np.cos(theta0(r))%0A%0A%20%20%20%20dlx0%20%3D%20lambda%20r%3A%20np.gradient(lx0(r)%2C%20r%2C%20edge_order%3Deo)%0A%20%20%20%20dly0%20%3D%20lambda%20r%3A%20np.gradient(ly0(r)%2C%20r%2C%20edge_order%3Deo)%0A%20%20%20%20dlz0%20%3D%20lambda%20r%3A%20np.gradient(lz0(r)%2C%20r%2C%20edge_order%3Deo)%0A%0A%20%20%20%20l0%20%3D%20lambda%20r%3A%20np.array(%5Blx0(r)%2C%20ly0(r)%2C%20lz0(r)%5D)%0A%20%20%20%20dl0%20%3D%20lambda%20r%3A%20np.array(%5Bdlx0(r)%2C%20dly0(r)%2C%20dlz0(r)%5D)%0A%20%20%20%20Lx0%20%3D%20lambda%20r%3A%20Sigma0(r)%20*%20r**2%20*%20W(r)%20*%20lx0(r)%0A%20%20%20%20Ly0%20%3D%20lambda%20r%3A%20Sigma0(r)%20*%20r**2%20*%20W(r)%20*%20ly0(r)%0A%20%20%20%20Lz0%20%3D%20lambda%20r%3A%20Sigma0(r)%20*%20r**2%20*%20W(r)%20*%20lz0(r)%0A%20%20%20%20L0%20%3D%20lambda%20r%3A%20np.sqrt(Lx0(r)%20**%202%20%2B%20Ly0(r)%20**%202%20%2B%20Lz0(r)%20**%202)%0A%0A%20%20%20%20G1x0%20%3D%20lambda%20r%3A%202%20*%20np.pi%20*%20r**3%20*%20nu1(r)%20*%20Sigma0(r)%20*%20dW(r)%20*%20lx0(r)%0A%20%20%20%20G1y0%20%3D%20lambda%20r%3A%202%20*%20np.pi%20*%20r**3%20*%20nu1(r)%20*%20Sigma0(r)%20*%20dW(r)%20*%20ly0(r)%0A%20%20%20%20G1z0%20%3D%20lambda%20r%3A%202%20*%20np.pi%20*%20r**3%20*%20nu1(r)%20*%20Sigma0(r)%20*%20dW(r)%20*%20lz0(r)%0A%0A%20%20%20%20G2x0%20%3D%20lambda%20r%3A%20np.pi%20*%20r**3%20*%20nu2(r)%20*%20Sigma0(r)%20*%20W(r)%20*%20dlx0(r)%0A%20%20%20%20G2y0%20%3D%20lambda%20r%3A%20np.pi%20*%20r**3%20*%20nu2(r)%20*%20Sigma0(r)%20*%20W(r)%20*%20dly0(r)%0A%20%20%20%20G2z0%20%3D%20lambda%20r%3A%20np.pi%20*%20r**3%20*%20nu2(r)%20*%20Sigma0(r)%20*%20W(r)%20*%20dlz0(r)%0A%0A%20%20%20%20G3x0%20%3D%20(%0A%20%20%20%20%20%20%20%20lambda%20r%3A%20np.pi%0A%20%20%20%20%20%20%20%20*%20r**3%0A%20%20%20%20%20%20%20%20*%20nu2(r)%0A%20%20%20%20%20%20%20%20*%20Sigma0(r)%0A%20%20%20%20%20%20%20%20*%20W(r)%0A%20%20%20%20%20%20%20%20*%20(ly0(r)%20*%20dlz0(r)%20-%20lz0(r)%20*%20dly0(r))%0A%20%20%20%20)%0A%20%20%20%20G3y0%20%3D%20(%0A%20%20%20%20%20%20%20%20lambda%20r%3A%20np.pi%0A%20%20%20%20%20%20%20%20*%20r**3%0A%20%20%20%20%20%20%20%20*%20nu2(r)%0A%20%20%20%20%20%20%20%20*%20Sigma0(r)%0A%20%20%20%20%20%20%20%20*%20W(r)%0A%20%20%20%20%20%20%20%20*%20(-lx0(r)%20*%20dlz0(r)%20%2B%20lz0(r)%20*%20dlx0(r))%0A%20%20%20%20)%0A%20%20%20%20G3z0%20%3D%20(%0A%20%20%20%20%20%20%20%20lambda%20r%3A%20np.pi%0A%20%20%20%20%20%20%20%20*%20r**3%0A%20%20%20%20%20%20%20%20*%20nu2(r)%0A%20%20%20%20%20%20%20%20*%20Sigma0(r)%0A%20%20%20%20%20%20%20%20*%20W(r)%0A%20%20%20%20%20%20%20%20*%20(lx0(r)%20*%20dly0(r)%20-%20ly0(r)%20*%20dlx0(r))%0A%20%20%20%20)%0A%0A%20%20%20%20G10%20%3D%20lambda%20r%3A%20np.sqrt(G1x0(r)%20**%202%20%2B%20G1y0(r)%20**%202%20%2B%20G1z0(r)%20**%202)%0A%20%20%20%20G20%20%3D%20lambda%20r%3A%20np.sqrt(G2x0(r)%20**%202%20%2B%20G2y0(r)%20**%202%20%2B%20G2z0(r)%20**%202)%0A%20%20%20%20G30%20%3D%20lambda%20r%3A%20np.sqrt(G3x0(r)%20**%202%20%2B%20G3y0(r)%20**%202%20%2B%20G3z0(r)%20**%202)%0A%0A%20%20%20%20figG%2C%20axG%20%3D%20plt.subplot_mosaic(%5B%5B%22G1%22%2C%20%22G2%22%2C%20%22G3%22%5D%5D%2C%20figsize%3D(16%2C%205))%0A%20%20%20%20axG%5B%22G1%22%5D.plot(rr%2C%20G10(rr))%0A%20%20%20%20axG%5B%22G2%22%5D.plot(rr%2C%20G20(rr))%0A%20%20%20%20axG%5B%22G3%22%5D.plot(rr%2C%20G30(rr))%0A%0A%20%20%20%20axG%5B%22G1%22%5D.set(title%3D%22%7CG1%7C%22%2C%20yscale%3D%22log%22)%0A%20%20%20%20axG%5B%22G2%22%5D.set(title%3D%22%7CG2%7C%22%2C%20yscale%3D%22log%22)%0A%20%20%20%20axG%5B%22G3%22%5D.set(title%3D%22%7CG3%7C%22%2C%20yscale%3D%22log%22)%0A%20%20%20%20%23%20mo.mpl.interactive(plt.gcf())%0A%20%20%20%20mo.accordion(items%3D%7B%22G%20plots%22%3A%20figG%7D)%0A%20%20%20%20return%20G10%2C%20G20%2C%20G30%2C%20L0%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Evolution%0A%20%20%20%20We%20can%20describe%20the%20evolution%20in%20time%20of%20the%20rings%20using%20**conservation%20of%20mass**%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cfrac%7B%5Cpartial%20%5CSigma%7D%7B%5Cpartial%20t%7D%2B%5Cfrac%7B1%7D%7Br%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20r%7D%5Cleft(r%20%5CSigma%20V_r%5Cright)%3D0%0A%20%20%20%20%24%24%0A%0A%20%20%20%20and%20**conservation%20of%20angular%20momentum**%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cfrac%7B%5Cpartial%20%5Cboldsymbol%7BL%7D%7D%7B%5Cpartial%20t%7D%2B%5Cfrac%7B1%7D%7Br%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20r%7D%5Cleft(r%20V_r%20%5Cboldsymbol%7BL%7D%5Cright)%3D%5Cfrac%7B1%7D%7Br%7D%20%5Cfrac%7B%5Cpartial%20%5Cboldsymbol%7BG%7D%7D%7B%5Cpartial%20r%7D%2B%5Cboldsymbol%7BT%7D%0A%20%20%20%20%24%24%0A%0A%0A%20%20%20%20%2F%2F%2F%20Details%20%7C%20radial%20velocity%20%24V_R%24%0A%0A%20%20%20%20Using%20%24L%3D%5Cdot%7B%5Cmathbf%7BL%7D%7D%5Ccdot%7B%5Chat%7Bl%7D%7D%20%3D%20r%5E2%5COmega%20%5Cdot%7B%5CSigma%7D%24%20we%20can%20take%20the%20angular%20momentum%20equation%20along%20%24%5Chat%7Bl%7D%24%20and%20multiple%20mass%20conservation%20with%20%24r%5E2%5COmega%24%20to%20find%20the%20angular%20velocity%0A%0A%20%20%20%20%5Cbegin%7Balign*%7D%0A%20%20%20%20V_r%20%26%3D%5Cfrac%7B1%7D%7Br%7D%20%5Cfrac%7B%5Cfrac%7B%5Cpartial%20G%7D%7B%5Cpartial%20r%7D%2BT%7D%7B%5CSigma%20(r%5E2%5COmega)'%7D%0A%20%20%20%20%5Cend%7Balign*%7D%0A%0A%20%20%20%20%2F%2F%2F%0A%0A%20%20%20%20%2F%2F%2F%20Details%20%7C%20Internal%20torques%20%24%5Cboldsymbol%7BG%7D%24%0A%20%20%20%20%23%23%23%20Internal%20torques%0A%20%20%20%20We%20can%20describe%20the%20%22internal%22%20torques%20%24%5Cboldsymbol%7BG%7D%24%20due%20to%20interaction%20between%20neighboring%20rings%20due%20to%20their%20relative%20%22misalignments%22.%20%0A%0A%20%20%20%20%5Cbegin%7Balign*%7D%0A%20%20%20%20%5Cboldsymbol%7BG%7D_1%20%26%3D%202%5Cpi%20r%5E3%20%5Cnu_1%20%5CSigma%20%5COmega'%5Chat%7Bl%7D%20%26%26%20%5Ctext%7Btorque%20tending%20to%20spin%20up%20(or%20down)%20the%20ring%7D%5C%5C%0A%20%20%20%20%5Cboldsymbol%7BG%7D_2%20%26%3D%5Cpi%20r%5E3%20%5Cnu_2%20%5CSigma%20%5COmega%20%5Chat%7Bl%7D'%20%26%26%20%5Ctext%7Btorque%20tending%20to%20align%20the%20ring%20with%20its%20neighbours%2C%20which%20acts%20to%20flatten%20the%20disc%7D%5C%5C%0A%20%20%20%20%5Cboldsymbol%7BG%7D_3%20%26%3D2%5Cpi%20r%5E3%20%5Cnu_3%20%5CSigma%20%5COmega%20%5Chat%7Bl%7D%5Ctimes%20%5Chat%7Bl%7D'%20%26%26%20%5Ctext%7Btorque%20tending%20to%20make%20the%20ring%20precess%20if%20it%20is%20misaligned%20with%20its%20neighbours%3B%20this%20leads%20to%20the%20dispersive%20wave-like%20propagation%20of%20the%20warp%7D%0A%20%20%20%20%5Cend%7Balign*%7D%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cboldsymbol%7BG%7D%20%3D%20%5Cboldsymbol%7BG%7D_1%20%2B%20%5Cboldsymbol%7BG%7D_2%20%2B%20%5Cboldsymbol%7BG%7D_3%20%3D%202%5Cpi%20r%5E3%20%5Cnu_1%20%5CSigma%20%5COmega'%5Chat%7Bl%7D%20%2B%20%5Cpi%20r%5E3%20%5Cnu_2%20%5CSigma%20%5COmega%20%5Chat%7Bl%7D'%20%2B2%5Cpi%20r%5E3%20%5Cnu_3%20%5CSigma%20%5COmega%20%5Chat%7Bl%7D%5Ctimes%20%5Chat%7Bl%7D'%0A%20%20%20%20%24%24%0A%0A%20%20%20%20In%20the%20literature%20these%20torques%20are%20using%20different%20kinenamtic%20viscosities%20(or%20just%20coefficients%20in%20Ogilvie%201999)%20but%20all%20the%20literature%20are%20for%20accretion%20disks.%20For%20now%20we%20are%20going%20to%20use%20the%20same%20%24%5Cnu%24%20defined%20previously%20for%20large%20scale%20(kpc)%20disks%2C%20so%20%24%5Cnu_1%3D%5Cnu_2%3D%5Cnu_3%3D%5Cnu%20(r)%24%0A%0A%20%20%20%20%2F%2F%2F%0A%0A%20%20%20%20%2F%2F%2F%20Details%20%7C%20External%20torques%20%24%5Cboldsymbol%7BT%7D%24%0A%20%20%20%20%23%23%23%20External%20torques%20%5Bassumed%20zero%20for%20now%5D%0A%20%20%20%20We%20can%20estimate%20the%20external%20torques%20due%20to%20asphericity%20of%20the%20stellar%20potential%20%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cboldsymbol%7BT%7D(t%2Cr)%20%3D%20T_%7B%5Cphi%7D%5Cbegin%7Bpmatrix%7D%0A%20%20%20%20%20%20%5Ccos%5Cphi%20%5C%5C%0A%20%20%20%20%20%20-%5Csin%20%5Cphi%5C%5C%0A%20%20%20%20%20%200%0A%20%20%20%20%20%5Cend%7Bpmatrix%7D%2B%20%0A%20%20%20%20%20T_%7B%5Ctheta%7D%5Cbegin%7Bpmatrix%7D%0A%20%20%20%20%20%20-%5Ccos%20%5Ctheta%20%5Csin%5Cphi%20%5C%5C%0A%20%20%20%20%20%20%5Ccos%20%5Ctheta%20%5Ccos%5Cphi%20%5C%5C%0A%20%20%20%20%20%20-%5Csin%20%5Ctheta%0A%20%20%20%20%20%5Cend%7Bpmatrix%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20and%20%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cbegin%7Balign%7D%0A%20%20%20%20T_%7B%5Cphi%7D(r%2C%5Ctheta%2C%5Cphi)%3D%5Cfrac%7B%20%5Cpartial%20%20%5Cleft%5Clangle%5CPhi_1%5Cright%5Crangle%7D%7B%20%5Cpartial%20%5Ctheta%20%7D(r%2C%5Ctheta%2C%5Cphi)%20%26%26%20T_%7B%5Ctheta%7D(r%2C%5Ctheta%2C%5Cphi)%3D%5Cfrac%7B%20%5Cpartial%20%20%5Cleft%5Clangle%5CPhi_1%5Cright%5Crangle%7D%7B%20%5Cpartial%20%5Cphi%20%7D(r%2C%5Ctheta%2C%5Cphi)%0A%20%20%20%20%5Cend%7Balign%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20and%20%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cbegin%7Balign%7D%0A%20%20%20%20%26%5Cfrac%7B%20%5Cpartial%20%20%5Cleft%5Clangle%5CPhi_1%5Cright%5Crangle%7D%7B%20%5Cpartial%20%5Ctheta%20%7D%20(r%2C%5Ctheta%2C%5Cphi)%3D%20-3%20C_%7B20%7D%20%5Cfrac%7BG%20M%20r_e%5E2%7D%7B2%20r%5E3%7D%20%20%5Csin%20%5Ctheta%20%5Ccos%20%5Ctheta%20-%206%20C_%7B22%7D%20%5Cfrac%7BG%20M%20r_e%5E2%7D%7B2%20r%5E3%7D%20%5Csin%20%5Ctheta%20%5Ccos%20%5Ctheta%20%5Ccos(2%20%5Cphi)%20%20%5C%5C%0A%20%20%20%20%26%5Cfrac%7B%20%5Cpartial%20%20%5Cleft%5Clangle%5CPhi_1%5Cright%5Crangle%7D%7B%20%5Cpartial%20%5Cphi%20%7D%20(r%2C%5Ctheta%2C%5Cphi)%3D%206%20C_%7B22%7D%5Cfrac%7BG%20M%20r_e%5E2%7D%7B2%20r%5E3%7D%20%5Csin%5E2%5Ctheta%20%5Csin(2%20%5Cphi)%0A%20%20%20%20%5Cend%7Balign%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20so%2C%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cboldsymbol%7BT%7D(t%2Cr)%20%3D%20%5Cfrac%7B3G%20M%20r_e%5E2%7D%7B2%20r%5E3%7D%5Csin%20%5Ctheta%5Cleft(-%5Cleft%5BC_%7B20%7D%20%2B2%20C_%7B22%7D%5Ccos(2%20%5Cphi)%20%5Cright%5D%20%5Ccos%20%5Ctheta%0A%20%20%20%20%5Cbegin%7Bpmatrix%7D%0A%20%20%20%20%20%20%5Ccos%5Cphi%20%5C%5C%0A%20%20%20%20%20%20-%5Csin%20%5Cphi%5C%5C%0A%20%20%20%20%20%200%0A%20%20%20%20%20%5Cend%7Bpmatrix%7D%2B%20%0A%20%20%20%202%20C_%7B22%7D%5Csin%5Ctheta%20%5Csin(2%20%5Cphi)%5Cbegin%7Bpmatrix%7D%0A%20%20%20%20%20%20-%5Ccos%20%5Ctheta%20%5Csin%5Cphi%20%5C%5C%0A%20%20%20%20%20%20%5Ccos%20%5Ctheta%20%5Ccos%5Cphi%20%5C%5C%0A%20%20%20%20%20%20-%5Csin%20%5Ctheta%0A%20%20%20%20%20%5Cend%7Bpmatrix%7D%0A%20%20%20%20%20%5Cright)%0A%20%20%20%20%24%24%0A%0A%20%20%20%20%2F%2F%2F%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(G10%2C%20G20%2C%20G30%2C%20L0%2C%20Sigma0%2C%20dr2W%2C%20eo%2C%20np%2C%20plt%2C%20rr%2C%20u)%3A%0A%20%20%20%20Vr0%20%3D%20lambda%20r%3A%20((DL_dt0(r))%20%2F%20(Sigma0(r)%20*%20dr2W(r))).to(u.km%20%2F%20u.s)%0A%0A%20%20%20%20DL_dt0%20%3D%20(%0A%20%20%20%20%20%20%20%20lambda%20r%3A%201%20%2F%20r%20*%20np.gradient(G10(r)%20%2B%20G20(r)%20%2B%20G30(r)%2C%20r%2C%20edge_order%3Deo)%0A%20%20%20%20)%20%20%23%20%2BT(r)%0A%0A%20%20%20%20t_source%20%3D%20L0(rr)%20%2F%20DL_dt0(rr)%0A%20%20%20%20t_adv%20%3D%20rr%20%2F%20Vr0(rr)%0A%20%20%20%20figL%2C%20axL%20%3D%20plt.subplot_mosaic(%0A%20%20%20%20%20%20%20%20%5B%5B%22L%22%2C%20%22Vr%22%2C%20%22T%22%5D%2C%20%5B%22DL%22%2C%20%22t%22%2C%20%22.%22%5D%5D%2C%20figsize%3D(16%2C%2011)%0A%20%20%20%20)%0A%20%20%20%20axL%5B%22L%22%5D.plot(rr%2C%20L0(rr))%0A%20%20%20%20axL%5B%22DL%22%5D.plot(rr%2C%20DL_dt0(rr))%0A%20%20%20%20axL%5B%22Vr%22%5D.plot(rr%2C%20Vr0(rr))%0A%0A%20%20%20%20axL%5B%22t%22%5D.plot(rr%2C%20t_source%2C%20label%3D%22Source%20term%22)%0A%20%20%20%20axL%5B%22t%22%5D.plot(rr%2C%20t_adv%2C%20label%3D%22Advection%20term%22)%0A%0A%20%20%20%20axL%5B%22L%22%5D.set(title%3D%22%7CL%7C%22%2C%20yscale%3D%22log%22)%0A%20%20%20%20axL%5B%22DL%22%5D.set(title%3Dr%22%7CDL%2FDt%7C%3D%7CdG%2Fdt%2Fr%20%2BT%7C%22%2C%20yscale%3D%22log%22)%0A%20%20%20%20axL%5B%22Vr%22%5D.set(title%3D%22Vr%22)%0A%20%20%20%20axL%5B%22T%22%5D.set(title%3D%22T%22)%0A%20%20%20%20axL%5B%22t%22%5D.set(title%3D%22Timescale%20(~L%2FDL%2FDt)%22)%0A%20%20%20%20axL%5B%22t%22%5D.legend()%0A%20%20%20%20%23%20mo.mpl.interactive(plt.gcf())%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Note%3A%20What%20other%20people%20do!%0A%0A%20%20%20%20As%20we%20said%20earlier%2C%20investigation%20of%20these%20equation%20are%20dominated%20by%20the%20protostellar%20and%20BH%20accretion%20disks.%20In%20these%20works%20(such%20as%20%5BMartin%202019%5D(%5Bhttps%3A%2F%2Farxiv.org%2Fabs%2F2109.12035%5D(https%3A%2F%2Farxiv.org%2Fabs%2F1902.11073))%2C%20%5BDullemond%202021%5D(https%3A%2F%2Farxiv.org%2Fabs%2F2109.12035))%20they%20separate%20the%20equations%20in%20two%20different%20regimes%0A%0A%20%20%20%20%23%23%23%20Wave-like%2C%20where%20the%20%24%5Cfrac%7B%5Cpartial%20%5CSigma%7D%7B%5Cpartial%20t%7D%5Csim%200%24%0A%20%20%20%20In%20the%20Shakura%20%26%20Sunyaev%20accretion%20disk%20parameterization%20%24%5Calpha%20%5Clt%20H%2Fr%24.%20In%20this%20regime%20the%20solutions%20are%20wave%20like%20and%20described%20by%20the%20equations%20(from%20Martin%202019%20in%20a%20Keplerian%20potential)%0A%0A%20%20%20%20%5Cbegin%7Balign*%7D%0A%20%20%20%20%5Cfrac%7B%5Cpartial%20G%7D%7B%5Cpartial%20t%7D%2B%5Comega%20l%20%5Ctimes%20G%2B%5Calpha%20%5COmega%20G%3D%5Cfrac%7B%5CSigma%20H%5E2%20R%5E3%20%5COmega%5E3%7D%7B4%7D%20%5Cfrac%7B%5Cpartial%20l%7D%7B%5Cpartial%20R%7D%0A%20%20%20%20%26%26%20%5C%2C%5Ctext%7Band%7D%5C%2C%20%26%26%0A%20%20%20%20%5CSigma%20R%5E2%20%5COmega%20%5Cfrac%7B%5Cpartial%20l%7D%7B%5Cpartial%20t%7D%3D%5Cfrac%7B1%7D%7BR%7D%20%5Cfrac%7B%5Cpartial%20G%7D%7B%5Cpartial%20R%7D%2BT%0A%20%20%20%20%5Cend%7Balign*%7D%0A%0A%20%20%20%20where%20%24%5Comega%3D%5Cfrac%7B%5COmega%5E2-%5Ckappa%5E2%7D%7B2%20%5COmega%7D%24%0A%0A%20%20%20%20%5BSo%20the%20G%20evolves%20also%20over%20time%3F%20Independently%3F%20Why%3F%5D%0A%0A%0A%20%20%20%20%23%23%23%20Viscous%20limit%2C%20%24%5Calpha%20%5Cgt%20H%2Fr%24%0A%20%20%20%20In%20this%20limit%20the%20equation%20gets%20to%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cbegin%7Balign*%7D%0A%20%20%20%20%5Cfrac%7B%5Cpartial%20L%7D%7B%5Cpartial%20t%7D%3D%20%26%20%5Cfrac%7B3%7D%7BR%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20R%7D%5Cleft%5B%5Cfrac%7BR%5E%7B1%20%2F%202%7D%7D%7B%5CSigma%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20R%7D%5Cleft(%5Cnu%20_1%20%5CSigma%20R%5E%7B1%20%2F%202%7D%5Cright)%20L%5Cright%5D%20%5C%5C%0A%20%20%20%20%26%20%2B%5Cfrac%7B1%7D%7BR%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20R%7D%5Cleft%5B%5Cleft(%5Cnu_2%20R%5E2%5Cleft%7C%5Cfrac%7B%5Cpartial%20l%7D%7B%5Cpartial%20R%7D%5Cright%7C%5E2-%5Cfrac%7B3%7D%7B2%7D%20%5Cnu%20_1%5Cright)%20L%5Cright%5D%20%5C%5C%0A%20%20%20%20%26%20%2B%5Cfrac%7B1%7D%7BR%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20R%7D%5Cleft%5B%5Cfrac%7B1%7D%7B2%7D%20%5Cnu_2%20R%7CL%7C%20%5Cfrac%7B%5Cpartial%20l%7D%7B%5Cpartial%20R%7D%5Cright%5D%2BT%0A%20%20%20%20%5Cend%7Balign*%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20%23%23%23%20Generalized%20Equations%0A%20%20%20%20In%20Martin%202019%20they%20construct%20a%20generalized%20equation%20just%20I%20do%20by%20solving%20%24V_r%24%20and%20using%20it%20inside%20the%20other%20two%20equations%20%5Bdoes%20not%20seem%20so%20%22genious%22%20idea%5D%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cbegin%7Baligned%7D%0A%20%20%20%20%26%5Cfrac%7B%5Cpartial%20%5CSigma%7D%7B%5Cpartial%20t%7D%3D-%5Cfrac%7B2%7D%7BR%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20R%7D%5Cleft%5B%5Cfrac%7B(%5Cpartial%20G%20%2F%20%5Cpartial%20R%20%5Ccdot%20l)%7D%7BR%20%5COmega%7D%5Cright%5D%5C%5C%0A%20%20%20%20%26%5Ctext%20%7B%20and%20%7D%5C%5C%0A%20%20%20%20%26%5Cfrac%7B%5Cpartial%20L%7D%7B%5Cpartial%20t%7D%3D-%5Cfrac%7B2%7D%7BR%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20R%7D%5Cleft%5B%5Cleft(%5Cfrac%7B(%5Cpartial%20G%20%2F%20%5Cpartial%20R%20%5Ccdot%20l)%7D%7B%5CSigma%20R%20%5COmega%7D%5Cright)%20L%5Cright%5D%2B%5Cfrac%7B1%7D%7BR%7D%20%5Cfrac%7B%5Cpartial%20G%7D%7B%5Cpartial%20R%7D%2BT%20.%0A%20%20%20%20%5Cend%7Baligned%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20and%20then%20they%20use%20a%20new%20dimensionless%20parameter%20%24%5Cbeta%24%20to%20stitch%20together%20the%20two%20regimes%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cbegin%7Baligned%7D%0A%20%20%20%20%26%20%5Cfrac%7B%5Cpartial%20G%7D%7B%5Cpartial%20t%7D%2B%5Comega%20l%20%5Ctimes%20G%2B%5Calpha%20%5COmega%20G%2B%5Cbeta%20%5COmega(G%20%5Ccdot%20l)%20l%3D%20%5C%5C%0A%20%20%20%20%26%20%5Cquad%20%5Cfrac%7B%5CSigma%20H%5E2%20R%5E3%20%5COmega%5E3%7D%7B4%7D%20%5Cfrac%7B%5Cpartial%20l%7D%7B%5Cpartial%20R%7D-%5Cfrac%7B3%7D%7B2%7D(%5Calpha%2B%5Cbeta)%20v_1%20%5CSigma%20R%5E2%20%5COmega%5E2%20l%20.%0A%20%20%20%20%5Cend%7Baligned%7D%0A%20%20%20%20%24%24%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%23%23%20Next%20steps%3A%20Solve%20the%20equation%0A%20%20%20%20The%20next%20step%20is%20to%20solve%20numerically%20the%20equations%20%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cfrac%7B%5Cpartial%20%5CSigma%7D%7B%5Cpartial%20t%7D%2B%5Cfrac%7B1%7D%7Br%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20r%7D%5Cleft(r%20%5CSigma%20V_r%5Cright)%3D0%0A%20%20%20%20%24%24%0A%0A%20%20%20%20and%20**conservation%20of%20angular%20momentum**%0A%0A%20%20%20%20%24%24%0A%20%20%20%20%5Cfrac%7B%5Cpartial%20%5Cboldsymbol%7BL%7D%7D%7B%5Cpartial%20t%7D%2B%5Cfrac%7B1%7D%7Br%7D%20%5Cfrac%7B%5Cpartial%7D%7B%5Cpartial%20r%7D%5Cleft(r%20V_r%20%5Cboldsymbol%7BL%7D%5Cright)%3D%5Cfrac%7B1%7D%7Br%7D%20%5Cfrac%7B%5Cpartial%20%5Cboldsymbol%7BG%7D%7D%7B%5Cpartial%20r%7D%2B%5Cboldsymbol%7BT%7D%0A%20%20%20%20%24%24%0A%0A%20%20%20%20using%20an%20intermediate%20step%20to%20calculate%20the%20radial%20velocity%0A%0A%20%20%20%20%5Cbegin%7Balign*%7D%0A%20%20%20%20V_r%20%26%3D%5Cfrac%7B1%7D%7Br%7D%20%5Cfrac%7B%5Cfrac%7B%5Cpartial%20G%7D%7B%5Cpartial%20r%7D%2BT%7D%7B%5CSigma%20(r%5E2%5COmega)'%7D%0A%20%20%20%20%5Cend%7Balign*%7D%0A%0A%20%20%20%20for%20the%20approximated%20values%20of%20%24%5Cboldsymbol%7BG%7D%24%20for%20the%20large%20scale%20galactic%20disks%20and%20without%20external%20Torques.%20The%20equations%20are%20stiff%20and%20need%20an%20implicit%2Fexplicit%20scheme%20and%20adaptive%20timescales.%20I%20tried%20the%20finite-volume-method%2C%20which%20is%20the%20state%20of%20the%20art%20on%20conservation%20laws%20with%20no%20luck.%20%0A%0A%20%20%20%20Simpler%20schemes%20such%20as%20high%20order%20spatial%20finite%20difference%20methods%20and%20adaptime%20time%20integration%20through%20%3E4th%20order%20Runge%20Kutta%20I%20had%20better%20results%20but%20without%20forcing%20boundary%20conditions%2C%20which%20add%20extreme%20numerical%20instabilities.%0A%0A%20%20%20%20If%20I%20get%20it%20to%20work%2C%20then%20we%20need%20to%20use%20the%20external%20torques%20which%20involve%20faster%20timescales%20towards%20the%20center%2C%20making%20the%20numerical%20solver%20even%20more%20difficult%20to%20solve.%0A%0A%20%20%20%20%23%23%23%20Jax%20library%0A%20%20%20%20I%20am%20using%20Jax%2C%20a%20python%20library%20which%20gives%203%20major%20advantages%0A%0A%20%20%20%201.%20The%20code%20gets%20compiled%20and%20highly%20optimized%2C%20so%20you%20can%20write%20custom%20code%20with%20C%20or%20Fortran%20like%20efficiency%0A%20%20%20%202.%20The%20compiled%20code%20it's%20GPU%20ready%20(so%20we%20can%20get%20even%20faster%20than%20C%20or%20Fortran)%0A%20%20%20%203.%20The%20final%20model%20(%3Dresulting%20orientations%2C%20surface%20densities%20at%20specific%20radii%20and%20times%20given%20the%20initial%20conditions)%20is%20auto-differentiable.%20This%20means%20that%20if%20for%20example%20we%20have%20assumed%20an%20initial%20condition%20like%20this%20%24%5Ctheta%20_0(r%3Ba%2Cb)%3Dax%2Bb%24%20we%20can%20get%20as%20a%20result%20the%20%24%5Cfrac%7B%5Cpartial%20%5Cmathrm%7Bmodel%7D(a%2Cb)%7D%7B%5Cpartial%20a%2Cb%7D%24%20etc.%20This%20is%20extremely%20useful%20if%20we%20have%20data%2C%20as%20we%20solve%20much%20much%20easier%20the%20inverse%20problem.%20Due%20to%20this%20we%20can%20also%20use%20generic%20(for%20example%20a%20neural%20network)%20%22curves%22%20(for%20example%20a%20generic%20unknown%20%24%5Cnu%20(r)%24)%20with%20hundrends%20of%20parameters%20and%20given%20good%20data%20get%20the%20final%20result.%20Also%2C%20we%20can%20use%20bayesian%20inference%20of%20the%20needed%20parameters%20as%20we%20can%20understand%20the%20parameter%20space%20much%20muich%20faster%20by%20having%20the%20derivatives%20at%20this%20space%0A%20%20%20%20%22%22%22%0A%20%20%20%20)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20def%20d_dr(r%2C%20y)%3A%0A%20%20%20%20%23%20%20%20%20%20return%20np.gradient(y%2C%20r%2C%20edge_order%3D2)%0A%0A%0A%20%20%20%20%23%20def%20dYdt(t%2C%20Y%2C%20r)%3A%0A%20%20%20%20%23%20%20%20%20%20S%2C%20Lx%2C%20Ly%2C%20Lz%20%3D%20Y.reshape(4%2C%20-1)%0A%20%20%20%20%23%20%20%20%20%20r%20%3D%20r%20*%20u.kpc%0A%20%20%20%20%23%20%20%20%20%20S%20%3D%20S%20*%20u.solMass%20%2F%20u.kpc**2%0A%20%20%20%20%23%20%20%20%20%20Lx%20%3D%20Lx%20*%20u.km%20%2F%20u.s%20*%20u.solMass%20%2F%20u.kpc%0A%20%20%20%20%23%20%20%20%20%20Ly%20%3D%20Ly%20*%20u.km%20%2F%20u.s%20*%20u.solMass%20%2F%20u.kpc%0A%20%20%20%20%23%20%20%20%20%20Lz%20%3D%20Lz%20*%20u.km%20%2F%20u.s%20*%20u.solMass%20%2F%20u.kpc%0A%0A%20%20%20%20%23%20%20%20%20%20L%20%3D%20np.sqrt(Lx**2%20%2B%20Ly**2%20%2B%20Lz**2)%0A%0A%20%20%20%20%23%20%20%20%20%20lx%20%3D%20Lx%20%2F%20L%0A%20%20%20%20%23%20%20%20%20%20ly%20%3D%20Ly%20%2F%20L%0A%20%20%20%20%23%20%20%20%20%20lz%20%3D%20Lz%20%2F%20L%0A%0A%20%20%20%20%23%20%20%20%20%20G1x%20%3D%202%20*%20np.pi%20*%20r**3%20*%20nu1(r)%20*%20S%20*%20dW(r)%20*%20lx%0A%20%20%20%20%23%20%20%20%20%20G1y%20%3D%202%20*%20np.pi%20*%20r**3%20*%20nu1(r)%20*%20S%20*%20dW(r)%20*%20ly%0A%20%20%20%20%23%20%20%20%20%20G1z%20%3D%202%20*%20np.pi%20*%20r**3%20*%20nu1(r)%20*%20S%20*%20dW(r)%20*%20lz%0A%0A%20%20%20%20%23%20%20%20%20%20dlx%20%3D%20d_dr(r%2C%20lx)%0A%20%20%20%20%23%20%20%20%20%20dly%20%3D%20d_dr(r%2C%20ly)%0A%20%20%20%20%23%20%20%20%20%20dlz%20%3D%20d_dr(r%2C%20lz)%0A%0A%20%20%20%20%23%20%20%20%20%20G2x%20%3D%20np.pi%20*%20r**3%20*%20nu2(r)%20*%20S%20*%20W(r)%20*%20dlx%0A%20%20%20%20%23%20%20%20%20%20G2y%20%3D%20np.pi%20*%20r**3%20*%20nu2(r)%20*%20S%20*%20W(r)%20*%20dly%0A%20%20%20%20%23%20%20%20%20%20G2z%20%3D%20np.pi%20*%20r**3%20*%20nu2(r)%20*%20S%20*%20W(r)%20*%20dlz%0A%0A%20%20%20%20%23%20%20%20%20%20Gx%20%3D%20G1x%20%2B%20G2x%0A%20%20%20%20%23%20%20%20%20%20Gy%20%3D%20G1y%20%2B%20G2y%0A%20%20%20%20%23%20%20%20%20%20Gz%20%3D%20G1z%20%2B%20G2z%0A%0A%20%20%20%20%23%20%20%20%20%20G_%20%3D%20np.sqrt(Gx**2%20%2B%20Gy**2%20%2B%20Gz**2)%0A%20%20%20%20%23%20%20%20%20%20Vr%20%3D%20d_dr(r%2C%20G_)%20%2F%20(r%20*%20S%20*%20d_dr(r%2C%20r**2%20*%20W(r)))%0A%0A%20%20%20%20%23%20%20%20%20%20dS_dt%20%3D%20-d_dr(r%2C%20r%20*%20S%20*%20Vr)%20%2F%20r%0A%20%20%20%20%23%20%20%20%20%20dLx_dt%20%3D%20-d_dr(r%2C%20r%20*%20Lx%20*%20Vr)%20%2F%20r%20%2B%20d_dr(r%2C%20Gx)%20%2F%20r%0A%20%20%20%20%23%20%20%20%20%20dLy_dt%20%3D%20-d_dr(r%2C%20r%20*%20Ly%20*%20Vr)%20%2F%20r%20%2B%20d_dr(r%2C%20Gy)%20%2F%20r%0A%20%20%20%20%23%20%20%20%20%20dLz_dt%20%3D%20-d_dr(r%2C%20r%20*%20Lz%20*%20Vr)%20%2F%20r%20%2B%20d_dr(r%2C%20Gz)%20%2F%20r%0A%0A%20%20%20%20%23%20%20%20%20%20derivatives%20%3D%20np.array(%5BdS_dt%2C%20dLx_dt%2C%20dLy_dt%2C%20dLz_dt%5D)%0A%20%20%20%20%23%20%20%20%20%20return%20derivatives.ravel()%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20Y0%20%3D%20np.array(%5BSigma0(rr)%2C%20Lx0(rr)%2C%20Ly0(rr)%2C%20Lz0(rr)%5D)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20from%20scipy.integrate%20import%20solve_ivp%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20sol%20%3D%20solve_ivp(dYdt%2C%5B0%2C0.2%5D%2CY0.ravel()%2Cargs%3D(rr.value%2C))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20import%20jax%0A%20%20%20%20%23%20import%20jax.numpy%20as%20jnp%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20Gj%20%3D%20jnp.array(G.value)%0A%20%20%20%20%23%20rrj%20%3D%20jnp.array(rr)%0A%20%20%20%20%23%20Mbhj%20%3D%20jnp.array(Mbh.value)%0A%20%20%20%20%23%20Mstarj%20%3D%20jnp.array(Mstar.value)%0A%20%20%20%20%23%20a_hernj%20%3D%20jnp.array(a_hern.value)%0A%20%20%20%20%23%20Vcirc_jax%20%3D%20lambda%20r%3A%20jnp.sqrt(Gj%20*%20Mbhj%20%2F%20r%20%2B%20(Gj%20*%20Mstarj%20*%20r)%20%2F%20(r%20%2B%20a_hernj)%20**%202)%0A%0A%20%20%20%20%23%20np.testing.assert_almost_equal(Vcirc_jax(rrj)%2C%20Vcirc(rr).value%2Cdecimal%3D4)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20W_jax%20%3D%20lambda%20r%3A%20Vcirc_jax(r)%20%2F%20r%0A%20%20%20%20%23%20dW_jax%20%3D%20lambda%20r%3A%20jnp.gradient(W_jax(r)%2C%20r)%0A%20%20%20%20%23%20dr2W_jax%20%3D%20lambda%20r%3A%20jnp.gradient(r**2%20*%20W_jax(r)%2C%20r)%0A%20%20%20%20%23%20dr3W_jax%20%3D%20lambda%20r%3A%20jnp.gradient(r**3%20*%20W_jax(r)%2C%20r)%0A%20%20%20%20%23%20k_jax%20%3D%20lambda%20r%3A%20jnp.sqrt(%0A%20%20%20%20%23%20%20%20%20%202%20*%20W_jax(r)%20%2F%20r%20*%20jnp.gradient(r**2%20*%20W_jax(r)%2C%20r)%0A%20%20%20%20%23%20)%0A%0A%20%20%20%20%23%20np.testing.assert_almost_equal(k_jax(rrj)%5B1%3A-2%5D%2C%20k(rr).value%5B1%3A-2%5D%2Cdecimal%3D2)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20sigma_gasj%20%3D%20jnp.array(sigma_gas_io.value)%0A%20%20%20%20%23%20nu_transform%20%3D%20jnp.array((sigma_gas**2%2Fk(rr)).unit.to(u.kpc**2%20%2F%20u.Gyr))%0A%20%20%20%20%23%20nu1_jax%20%3D%20lambda%20r%3A%20(sigma_gasj**2%20%2F%20k_jax(r))*nu_transform%0A%20%20%20%20%23%20nu2_jax%20%3D%20lambda%20r%3A%20(sigma_gasj**2%20%2F%20k_jax(r))*nu_transform%0A%0A%20%20%20%20%23%20np.testing.assert_almost_equal(nu1_jax(rrj)%5B1%3A-2%5D%2C%20nu1(rr).value%5B1%3A-2%5D%2Cdecimal%3D3)%0A%20%20%20%20%23%20np.testing.assert_almost_equal(nu2_jax(rrj)%5B1%3A-2%5D%2C%20nu2(rr).value%5B1%3A-2%5D%2Cdecimal%3D3)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20%40jax.jit%0A%20%20%20%20%23%20def%20jnp_gradient_edge_order4(f%2C%20x)%3A%0A%20%20%20%20%23%20%20%20%20%20dx%3Dx%5B6%5D-x%5B5%5D%0A%20%20%20%20%23%20%20%20%20%20df%20%3D%20jnp.zeros_like(f)%0A%0A%20%20%20%20%23%20%20%20%20%20%23%20Interior%20points%3A%204th-order%20central%20difference%0A%20%20%20%20%23%20%20%20%20%20df%20%3D%20df.at%5B2%3A-2%5D.set((f%5B%3A-4%5D%20-%208*f%5B1%3A-3%5D%20%2B%208*f%5B3%3A-1%5D%20-%20f%5B4%3A%5D)%20%2F%20(12%20*%20dx))%0A%0A%20%20%20%20%23%20%20%20%20%20%23%20Edges%3A%201st%2C%202nd%2C%20N-2%2C%20N-1%20use%20lower-order%20accurate%20formulas%0A%20%20%20%20%23%20%20%20%20%20df%20%3D%20df.at%5B0%5D.set((-25*f%5B0%5D%20%2B%2048*f%5B1%5D%20-%2036*f%5B2%5D%20%2B%2016*f%5B3%5D%20-%203*f%5B4%5D)%20%2F%20(12%20*%20dx))%0A%20%20%20%20%23%20%20%20%20%20df%20%3D%20df.at%5B1%5D.set((-3*f%5B0%5D%20-%2010*f%5B1%5D%20%2B%2018*f%5B2%5D%20-%206*f%5B3%5D%20%2B%20f%5B4%5D)%20%2F%20(12%20*%20dx))%0A%20%20%20%20%23%20%20%20%20%20df%20%3D%20df.at%5B-2%5D.set((-f%5B-5%5D%20%2B%206*f%5B-4%5D%20-%2018*f%5B-3%5D%20%2B%2010*f%5B-2%5D%20%2B%203*f%5B-1%5D)%20%2F%20(12%20*%20dx))%0A%20%20%20%20%23%20%20%20%20%20df%20%3D%20df.at%5B-1%5D.set((3*f%5B-5%5D%20-%2016*f%5B-4%5D%20%2B%2036*f%5B-3%5D%20-%2048*f%5B-2%5D%20%2B%2025*f%5B-1%5D)%20%2F%20(12%20*%20dx))%0A%0A%20%20%20%20%23%20%20%20%20%20return%20df%0A%0A%20%20%20%20%23%20def%20d_dr_jax(r%2C%20y)%3A%0A%20%20%20%20%23%20%20%20%20%20return%20jnp_gradient_edge_order4(y%2Cr)%23jnp.gradient(y%2C%20r)%0A%0A%20%20%20%20%23%20def%20dYdt_jax(t%2C%20Y%2C%20r)%3A%0A%20%20%20%20%23%20%20%20%20%20S%2C%20Lx%2C%20Ly%2C%20Lz%20%3D%20Y.reshape(4%2C%20-1)%0A%0A%20%20%20%20%23%20%20%20%20%20L%20%3D%20jnp.sqrt(Lx**2%20%2B%20Ly**2%20%2B%20Lz**2)%0A%0A%20%20%20%20%23%20%20%20%20%20lx%20%3D%20Lx%20%2F%20L%0A%20%20%20%20%23%20%20%20%20%20ly%20%3D%20Ly%20%2F%20L%0A%20%20%20%20%23%20%20%20%20%20lz%20%3D%20Lz%20%2F%20L%0A%0A%20%20%20%20%23%20%20%20%20%20G1x%20%3D%202%20*%20jnp.pi%20*%20r**3%20*%20nu1_jax(r)%20*%20S%20*%20dW_jax(r)%20*%20lx%0A%20%20%20%20%23%20%20%20%20%20G1y%20%3D%202%20*%20jnp.pi%20*%20r**3%20*%20nu1_jax(r)%20*%20S%20*%20dW_jax(r)%20*%20ly%0A%20%20%20%20%23%20%20%20%20%20G1z%20%3D%202%20*%20jnp.pi%20*%20r**3%20*%20nu1_jax(r)%20*%20S%20*%20dW_jax(r)%20*%20lz%0A%0A%20%20%20%20%23%20%20%20%20%20dlx%20%3D%20d_dr_jax(r%2C%20lx)%0A%20%20%20%20%23%20%20%20%20%20dly%20%3D%20d_dr_jax(r%2C%20ly)%0A%20%20%20%20%23%20%20%20%20%20dlz%20%3D%20d_dr_jax(r%2C%20lz)%0A%0A%20%20%20%20%23%20%20%20%20%20G2x%20%3D%20jnp.pi%20*%20r**3%20*%20nu2_jax(r)%20*%20S%20*%20W_jax(r)%20*%20dlx%0A%20%20%20%20%23%20%20%20%20%20G2y%20%3D%20jnp.pi%20*%20r**3%20*%20nu2_jax(r)%20*%20S%20*%20W_jax(r)%20*%20dly%0A%20%20%20%20%23%20%20%20%20%20G2z%20%3D%20jnp.pi%20*%20r**3%20*%20nu2_jax(r)%20*%20S%20*%20W_jax(r)%20*%20dlz%0A%0A%20%20%20%20%23%20%20%20%20%20Gx%20%3D%20G1x%20%2B%20G2x%0A%20%20%20%20%23%20%20%20%20%20Gy%20%3D%20G1y%20%2B%20G2y%0A%20%20%20%20%23%20%20%20%20%20Gz%20%3D%20G1z%20%2B%20G2z%0A%0A%20%20%20%20%23%20%20%20%20%20G_%20%3D%20jnp.sqrt(Gx**2%20%2B%20Gy**2%20%2B%20Gz**2)%0A%20%20%20%20%23%20%20%20%20%20Vr%20%3D%20d_dr_jax(r%2C%20G_)%20%2F%20(r%20*%20S%20*%20d_dr_jax(r%2C%20r**2%20*%20W_jax(r)))%0A%0A%20%20%20%20%23%20%20%20%20%20dS_dt%20%3D%20-d_dr_jax(r%2C%20r%20*%20S%20*%20Vr)%20%2F%20r%0A%20%20%20%20%23%20%20%20%20%20dLx_dt%20%3D%20-d_dr_jax(r%2C%20r%20*%20Lx%20*%20Vr)%20%2F%20r%20%2B%20d_dr_jax(r%2C%20Gx)%20%2F%20r%0A%20%20%20%20%23%20%20%20%20%20dLy_dt%20%3D%20-d_dr_jax(r%2C%20r%20*%20Ly%20*%20Vr)%20%2F%20r%20%2B%20d_dr_jax(r%2C%20Gy)%20%2F%20r%0A%20%20%20%20%23%20%20%20%20%20dLz_dt%20%3D%20-d_dr_jax(r%2C%20r%20*%20Lz%20*%20Vr)%20%2F%20r%20%2B%20d_dr_jax(r%2C%20Gz)%20%2F%20r%0A%0A%20%20%20%20%23%20%20%20%20%20derivatives%20%3D%20jnp.array(%5BdS_dt%2C%20dLx_dt%2C%20dLy_dt%2C%20dLz_dt%5D)%0A%20%20%20%20%23%20%20%20%20%20return%20derivatives.ravel()%0A%0A%20%20%20%20%23%20%40jax.jit%0A%20%20%20%20%23%20def%20dY_dt_jax_wrapper(t%2CY)%3A%0A%20%20%20%20%23%20%20%20%20%20return%20dYdt_jax(t%2C%20Y%2C%20rrj)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20Y0j%20%3D%20jnp.array(%5BSigma0(rr)%2C%20Lx0(rr)%2C%20Ly0(rr)%2C%20Lz0(rr)%5D)%0A%0A%20%20%20%20%23%20np.testing.assert_almost_equal(Y0j.ravel()%2C%20Y0.ravel()%2Cdecimal%3D3)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20dY_dt_jax_wrapper(0.0%2C%20Y0j.ravel())%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20sol_jax%20%3D%20solve_ivp(dY_dt_jax_wrapper%2C%5B0%2C0.2%5D%2CY0.ravel()%2Cmethod%3D%22LSODA%22%2Catol%3D1e-3%2Crtol%3D1e-2%2Cdense_output%3DTrue)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20sol_jax%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20ttj%20%3Djnp.linspace(0%2C0.1%2C10)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20S_%2C%20Lx_%2C%20Ly_%2C%20Lz_%20%3D%20sol_jax.sol(ttj)%5B%3A%2C1%5D.reshape(4%2C%20-1)%0A%20%20%20%20%23%20plt.plot(rrj%2CS_)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A</marimo-code></head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "notebook.py",
            "mode": "read",
            "version": "0.16.0",
            "serverToken": "unused",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "display": {"cell_output": "above", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": false, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": true}}, "package_management": {"manager": "uv"}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "off", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"auto_download": ["html"], "sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": false},
            "notebook": null,
            "session": null,
            "runtimeConfig": null,
        };
    </script>
  </body>
</html>
